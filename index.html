<!DOCTYPE html>
<html lang="de"> <!-- Sets the language of the document to German -->
<head>
    <meta charset="UTF-8"> <!-- Specifies the character encoding for the document -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Configures the viewport for responsive design -->
    <title>Markdown Viewer</title> <!-- Sets the title that appears in the browser tab -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Includes the Marked library for Markdown parsing -->
    <!-- Toast UI Editor CDN -->
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" /> <!-- Stylesheet for Toast UI Editor -->
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script> <!-- JavaScript for Toast UI Editor -->
    <style>
        /* CSS Custom Properties (Variables) for consistent styling */
        :root {
            --font-family-apple: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; /* Defines a system font stack similar to Apple's UI */
            
            /* iOS Blue Color Palette */
            --ios-blue: #007AFF; /* Standard iOS blue */
            --ios-blue-hover: #0056b3; /* Darker blue for hover states */
            --ios-blue-selected: #006adc; /* Slightly different blue for selected states */

            /* iOS Grays (Light Mode) - Mimicking iOS system gray colors */
            --ios-system-gray-6: #f2f2f7; /* Primary background for grouped content */
            --ios-system-gray-5: #e5e5ea; /* Secondary background for grouped content */
            --ios-system-gray-4: #d1d1d6; /* Tertiary fill, separators */
            --ios-system-gray-3: #c7c7cc; /* Quaternary fill */
            --ios-system-gray-2: #aeaeb2; /* Placeholder text, secondary labels */
            --ios-system-gray-1: #8e8e93; /* Tertiary labels */

            /* iOS Text Colors (Light Mode) */
            --ios-label-primary: #000000; /* Primary text color (black) */
            --ios-label-secondary: rgba(60, 60, 67, 0.6); /* Secondary text color with opacity */
            --ios-label-tertiary: rgba(60, 60, 67, 0.3);  /* Tertiary text color with opacity */
            --ios-label-quaternary: rgba(60, 60, 67, 0.18); /* Quaternary text color with opacity */

            --ios-white: #ffffff; /* Pure white color */
            
            /* Application Theme Colors */
            --background-color: var(--ios-system-gray-6); /* Overall background color of the page */
            --app-background-color: var(--ios-white);  /* Background color of the main application container */
            --sidebar-background: var(--ios-system-gray-6); /* Background color for the sidebar */
            --content-background: var(--ios-white); /* Background color for the content area */
            
            /* Text Color Variables */
            --text-color: var(--ios-label-primary); /* Default text color */
            --text-color-secondary: var(--ios-label-secondary); /* Secondary text color */
            --text-color-placeholder: var(--ios-system-gray-2); /* Color for placeholder text */

            /* Border and Separator Colors */
            --border-color: var(--ios-system-gray-4); /* Default border color */
            --separator-color: var(--ios-system-gray-5); /* Color for separators/dividers */

            /* Accent Colors */
            --accent-color: var(--ios-blue); /* Primary accent color */
            --hover-accent-color: var(--ios-blue-hover); /* Accent color for hover states */
            --selected-accent-color: var(--ios-blue-selected); /* Accent color for selected items */

            /* Border Radius Variables */
            --border-radius-standard: 8px; /* Standard iOS corner radius */
            --border-radius-large: 12px; /* For larger elements like the app container */
            
            /* Box Shadow Variables */
            --box-shadow-subtle: 0 1px 2px rgba(0,0,0,0.03), 0 2px 4px rgba(0,0,0,0.03); /* Subtle shadow for elements */
            --box-shadow-card: 0 4px 10px rgba(0,0,0,0.08), 0 0 0 0.5px rgba(0,0,0,0.06); /* Shadow for card-like elements, mimicking a window */

            /* Layout Sizing Variables */
            --sidebar-width: 330px; /* Width of the sidebar */
            --header-height: 50px; /* Height of the content header */
            --title-bar-height: 38px; /* Height of the macOS-like title bar */
            --app-max-width: 1400px; /* Maximum width of the application container */
            --app-padding: 16px; /* Padding around the app container when not full screen */

            /* NEW Sizing Variables for UI Elements */
            --button-padding-y: 14px;  /* Vertical padding for buttons */
            --button-padding-x: 22px;  /* Horizontal padding for buttons */
            --button-font-size: 17px;    /* Font size for buttons */
            --list-item-padding-y: 14px;  /* Vertical padding for list items */
            --list-item-padding-x: 18px;  /* Horizontal padding for list items */
            --list-item-font-size: 17px;   /* Font size for list items */

            /* Enhanced Button Aesthetics */
            --button-shadow-idle: 0 2px 4px rgba(0,0,0,0.05), 0 1px 1px rgba(0,0,0,0.03); /* Shadow for buttons in idle state */
            --button-shadow-hover: 0 4px 8px rgba(0,0,0,0.07), 0 2px 3px rgba(0,0,0,0.04); /* Shadow for buttons on hover */
            --button-shadow-active: inset 0 1px 2px rgba(0,0,0,0.1); /* Inner shadow for buttons when active/pressed */
            --button-text-shadow: 0 1px 0px rgba(0,0,0,0.1); /* Subtle text shadow for button text to add depth */
        }

        /* General body styling */
        body {
            font-family: var(--font-family-apple); /* Sets the default font for the page */
            margin: 0; /* Removes default browser margin */
            background-color: var(--background-color); /* Sets the background color of the page */
            color: var(--text-color); /* Sets the default text color */
            line-height: 1.5; /* Adjusts line height for better readability, inspired by SF Text */
            display: flex; /* Uses flexbox for layout */
            flex-direction: column; /* Arranges children vertically */
            justify-content: flex-start; /* Aligns content to the top vertically */ /* Changed from center for typical column layout */
            align-items: center; /* Centers content horizontally */ /* This will center app-wrapper if it's not 100% width */
            min-height: 100vh; /* Ensures the body takes at least the full viewport height */
            padding: 0; /* Adds padding around the body content - CHANGED */
            box-sizing: border-box; /* Includes padding and border in the element's total width and height */
            -webkit-font-smoothing: antialiased; /* Improves font rendering on WebKit browsers */
            -moz-osx-font-smoothing: grayscale; /* Improves font rendering on Firefox for macOS */
        }

        /* Main application container styling */
        .app-container {
            width: 100%; /* Takes the full width of its parent */
            max-width: var(--app-max-width); /* Limits the maximum width */
            min-height: 400px;  /* Minimum height for the container */
            /* max-height: calc(100vh - (2 * var(--app-padding)));  REMOVED to allow flex-grow to manage height */
            display: flex; /* Uses flexbox for internal layout */
            flex-direction: column; /* Arranges children vertically */
            background-color: var(--app-background-color); /* Sets the background color */
            border-radius: var(--border-radius-large);  /* Applies rounded corners */
            box-shadow: var(--box-shadow-card); /* Adds a card-like shadow */
            overflow: hidden; /* Hides content that overflows the container */
            border: 1px solid var(--ios-system-gray-4);  /* Adds a border */
            flex-grow: 1; /* ADDED - Allows app-container to take available space */
        }

        /* macOS-like window title bar styling */
        .window-title-bar {
            height: var(--title-bar-height); /* Sets the height of the title bar */
            background-color: var(--ios-system-gray-5);  /* Sets the background color */
            display: flex; /* Uses flexbox for internal layout */
            align-items: center; /* Aligns items vertically centered */
            justify-content: space-between;  /* Distributes space between items */
            padding: 0 12px; /* Adds horizontal padding */
            box-sizing: border-box; /* Includes padding in the element's total width and height */
            border-bottom: 1px solid var(--ios-system-gray-4); /* Adds a bottom border */
            flex-shrink: 0; /* Prevents the title bar from shrinking */
            border-top-left-radius: var(--border-radius-large);  /* Rounds the top-left corner */
            border-top-right-radius: var(--border-radius-large);  /* Rounds the top-right corner */
            position: relative;  /* Sets positioning context for potential children */
        }

        /* Mobile menu button (hamburger icon) styling */
        .mobile-menu-button {
            display: none;  /* Hidden by default, shown in mobile view via media query */
            background: transparent; /* Transparent background */
            border: none; /* No border */
            cursor: pointer; /* Changes cursor to pointer on hover */
            padding: 8px; /* Adds padding */
            margin-left: auto;  /* Pushes the button to the right */
            border-radius: 6px;  /* Applies rounded corners */
            transition: background-color 0.15s ease; /* Smooth transition for background color */
        }
        .mobile-menu-button:hover {
            background-color: rgba(60, 60, 67, 0.08);  /* Slight background color on hover */
        }
        .mobile-menu-button:active {
            background-color: rgba(60, 60, 67, 0.12);  /* Slightly darker background on active/click */
        }
        .mobile-menu-button svg {
            width: 20px; /* Sets the width of the SVG icon */
            height: 20px; /* Sets the height of the SVG icon */
            fill: var(--ios-label-primary); /* Sets the fill color of the SVG icon */
        }

        /* Traffic lights (macOS window controls) container styling */
        .traffic-lights {
            display: flex; /* Uses flexbox for layout */
            align-items: center; /* Aligns items vertically centered */
        }

        /* Individual traffic light styling */
        .traffic-light {
            width: 12px; /* Sets the width */
            height: 12px; /* Sets the height */
            border-radius: 50%; /* Makes it circular */
            margin-right: 8px; /* Adds space to the right */
            box-sizing: border-box; /* Includes border in the element's total width and height */
        }

        /* Specific colors for each traffic light */
        .traffic-light.red { background-color: #FF5F57; border: 0.5px solid #E0443E; } /* Red light with border */
        .traffic-light.yellow { background-color: #FEBC2E; border: 0.5px solid #DFA023; } /* Yellow light with border */
        .traffic-light.green { background-color: #28C840; border: 0.5px solid #1AA12C; } /* Green light with border */
        
        /* Window title text styling */
        .window-title-text {
            font-family: var(--font-family-apple); /* Sets the font */
            font-size: 13px;  /* Sets the font size */
            font-weight: 500;  /* Sets the font weight */
            color: var(--ios-label-primary);  /* Sets the text color */
            text-align: center; /* Centers the text */
            flex-grow: 1;  /* Allows the text to take available space */
            line-height: var(--title-bar-height);  /* Vertically centers text within the title bar */
            white-space: nowrap; /* Prevents text from wrapping */
            overflow: hidden; /* Hides overflowing text */
            text-overflow: ellipsis; /* Adds an ellipsis (...) for overflowing text */
            padding: 0 50px;  /* Adds horizontal padding to prevent overlap with controls */
        }

        /* Wrapper for the main content area (sidebar and content) */
        .main-content-wrapper {
            display: flex; /* Uses flexbox for layout */
            flex-direction: row;  /* Arranges children horizontally (sidebar, content) */
            flex-grow: 1; /* Allows the wrapper to take available vertical space */
            overflow: hidden; /* Hides overflowing content */
        }

        /* Sidebar styling */
        .sidebar {
            width: var(--sidebar-width); /* Sets the width of the sidebar */
            background-color: var(--sidebar-background); /* Sets the background color */
            border-right: 1px solid var(--border-color);  /* Adds a right border */
            padding: 16px; /* Adds padding */
            box-sizing: border-box; /* Includes padding and border in the element's total width and height */
            display: flex; /* Uses flexbox for internal layout */
            flex-direction: column; /* Arranges children vertically */
            overflow-y: auto; /* Adds a vertical scrollbar if content overflows */
            flex-shrink: 0;  /* Prevents the sidebar from shrinking */
            position: static;  /* Default positioning */
            transform: none;  /* No transformation by default */
            transition: none;  /* No transition by default */
            z-index: auto; /* Default stacking order */
        }
        
        /* Sidebar header styling (e.g., "Explorer") */
        .sidebar-header {
            font-size: 18px;  /* Sets the font size */
            font-weight: 600; /* Sets the font weight */
            margin-bottom: 20px;  /* Adds space below the header */
            padding-top: 10px; /* Adds padding at the top */
            padding-bottom: 15px; /* Adds padding at the bottom */
            color: var(--text-color); /* Sets the text color */
            border-bottom: 1px solid var(--separator-color); /* Adds a bottom border as a separator */
        }

        /* Area for folder and file selection buttons */
        .folder-selection-area {
            display: grid; /* Uses CSS Grid for layout */
            grid-template-columns: 1fr 1fr; /* Two equal-width columns */
            grid-template-rows: auto auto; /* Rows adjust to content height */
            gap: 12px;  /* Space between grid items */
            margin-bottom: 24px;  /* Space below this area */
        }

        /* Styling for folder and single file input buttons */
        #folderInputButton,
        #singleFileInputButton {
            background-color: var(--accent-color); /* Sets the background color */
            color: var(--ios-white); /* Sets the text color */
            border: none;  /* Removes the default border */
            /* border-bottom: 1px solid rgba(0,0,0,0.15); Optional: for a bit more depth */
            padding: var(--button-padding-y) var(--button-padding-x); /* Sets padding using variables */
            border-radius: var(--border-radius-standard); /* Applies rounded corners */
            cursor: pointer; /* Changes cursor to pointer on hover */
            font-family: var(--font-family-apple); /* Sets the font */
            font-size: var(--button-font-size); /* Sets the font size using a variable */
            font-weight: 500;  /* Sets the font weight */
            transition: background-color 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease; /* Smooth transitions for various properties */
            width: 100%; /* Makes buttons take the full width of their grid cell */
            box-sizing: border-box; /* Includes padding and border in the element's total width and height */
            text-align: center; /* Centers the text */
            white-space: nowrap; /* Prevents text from wrapping */
            overflow: hidden; /* Hides overflowing text */
            text-overflow: ellipsis; /* Adds an ellipsis (...) for overflowing text */
            line-height: 1.3;  /* Adjusts line height */
            box-shadow: var(--button-shadow-idle); /* Applies idle state shadow */
            /* text-shadow: var(--button-text-shadow); */ /* Optional: enable for text depth */
        }

        /* Hover state for folder and single file input buttons */
        #folderInputButton:hover,
        #singleFileInputButton:hover {
            background-color: var(--hover-accent-color); /* Changes background color on hover */
            box-shadow: var(--button-shadow-hover); /* Applies hover state shadow */
            transform: translateY(-1px); /* Slight upward lift on hover */
        }

        /* Active (pressed) state for folder and single file input buttons */
        #folderInputButton:active,
        #singleFileInputButton:active {
            background-color: var(--selected-accent-color); /* Changes background color when active */
            transform: scale(0.97) translateY(0px);  /* Slightly scales down and resets lift */
            box-shadow: var(--button-shadow-active); /* Applies active state shadow */
        }
        
        /* Grid placement for the folder input button */
        #folderInputButton {
            grid-column: 1 / 2; /* Spans the first column */
            grid-row: 1 / 2; /* Spans the first row */
        }

        /* Grid placement for the single file input button */
        #singleFileInputButton {
            grid-column: 2 / 3; /* Spans the second column */
            grid-row: 1 / 2; /* Spans the first row */
        }

        /* Styling for the display of the selected folder name */
        #selectedFolderName {
            grid-column: 1 / -1; /* Spans all columns */
            grid-row: 2 / 3; /* Spans the second row */
            font-size: 14px;  /* Sets the font size */
            color: var(--text-color-secondary); /* Sets the text color */
            text-align: center; /* Centers the text */
            word-break: break-all; /* Allows long folder names to break and wrap */
            padding: 8px 10px;  /* Adds padding */
            background-color: var(--ios-system-gray-5); /* Sets the background color */
            border-radius: calc(var(--border-radius-standard) - 2px); /* Slightly smaller border radius */
            margin-top: 0;  /* Removes top margin */
            line-height: 1.4; /* Adjusts line height */
        }

        /* Styling for the header of the file browser section (e.g., "Dateien") */
        .file-browser-header {
            font-family: var(--font-family-apple); /* Sets the font */
            font-size: 14px;  /* Sets the font size */
            font-weight: 600;  /* Sets the font weight */
            color: var(--text-color-secondary); /* Sets the text color */
            margin-top: 24px;  /* Adds space above */
            margin-bottom: 12px;  /* Adds space below */
            padding-left: var(--list-item-padding-x);  /* Aligns with list item padding */
            text-transform: uppercase; /* Converts text to uppercase */
            letter-spacing: 0.8px;  /* Adds letter spacing */
        }

        /* Styling for the file browser container */
        .file-browser {
            flex-grow: 1; /* Allows the browser to take available vertical space */
            overflow-y: auto; /* Adds a vertical scrollbar if content overflows */
            display: flex; /* Uses flexbox for internal layout */
            flex-direction: column; /* Arranges children vertically */
        }

        /* Styling for the list of files */
        #fileList {
            list-style: none; /* Removes default list styling (bullets) */
            padding: 0; /* Removes default padding */
            margin: 0; /* Removes default margin */
            flex-grow: 1; /* Allows the list to take available space */
        }

        /* Styling for individual file list items */
        #fileList li {
            padding: var(--list-item-padding-y) var(--list-item-padding-x); /* Sets padding using variables */
            cursor: pointer; /* Changes cursor to pointer on hover */
            border-radius: var(--border-radius-standard); /* Applies rounded corners */
            margin-bottom: 6px;  /* Adds space below each item */
            font-size: var(--list-item-font-size); /* Sets font size using a variable */
            font-family: var(--font-family-apple); /* Sets the font */
            color: var(--text-color); /* Sets the text color */
            transition: background-color 0.15s ease, color 0.15s ease, transform 0.1s ease; /* Smooth transitions */
            white-space: nowrap; /* Prevents text from wrapping */
            overflow: hidden; /* Hides overflowing text */
            text-overflow: ellipsis; /* Adds an ellipsis (...) for overflowing text */
            line-height: 1.45;  /* Adjusts line height */
        }

        /* Hover state for file list items */
        #fileList li:hover {
            background-color: var(--ios-system-gray-5); /* Changes background color on hover */
        }

        /* Selected state for file list items */
        #fileList li.selected {
            background-color: var(--selected-accent-color); /* Changes background color for selected item */
            color: var(--ios-white); /* Changes text color for selected item */
            font-weight: 600;  /* Makes text bold for selected item */
        }

        /* Main content area (where Markdown is displayed or edited) styling */
        .content-area {
            flex-grow: 1; /* Allows the content area to take available space */
            background-color: var(--content-background); /* Sets the background color */
            padding: 0; /* No padding by default, handled by children */
            overflow-y: auto; /* Adds a vertical scrollbar if content overflows */
            display: flex; /* Uses flexbox for internal layout */
            flex-direction: column; /* Arranges children vertically */
        }
        
        /* Header within the content area (displays file name and edit button) */
        .content-header {
            height: var(--header-height); /* Sets the height */
            display: flex; /* Uses flexbox for layout */
            align-items: center; /* Aligns items vertically centered */
            justify-content: space-between;  /* Distributes space between items */
            padding: 0 16px;  /* Adds horizontal padding */
            border-bottom: 1px solid var(--border-color); /* Adds a bottom border */
            box-sizing: border-box; /* Includes padding and border in the element's total width and height */
            flex-shrink: 0; /* Prevents the header from shrinking */
        }

        /* Text in the content header (usually the file name) */
        #contentHeaderText {
            font-size: 17px;  /* Sets the font size */
            font-weight: 600;  /* Sets the font weight */
            color: var(--text-color); /* Sets the text color */
            white-space: nowrap; /* Prevents text from wrapping */
            overflow: hidden; /* Hides overflowing text */
            text-overflow: ellipsis; /* Adds an ellipsis (...) for overflowing text */
            text-align: center;  /* Centers the text */
            flex-grow: 1; /* Allows the text to take available space */
            margin-right: 8px; /* Adds space to the right, for buttons */
        }

        /* General styling for buttons in the header (e.g., Edit/Save button) */
        .header-button { 
            background-color: var(--accent-color); /* Sets background color */
            color: var(--ios-white); /* Sets text color */
            border: none; /* Removes default border */
            /* border-bottom: 1px solid rgba(0,0,0,0.1); */ /* Optional: for a bit more depth */
            padding: 8px 16px; /* Sets padding */
            border-radius: var(--border-radius-standard); /* Applies rounded corners */
            cursor: pointer; /* Changes cursor to pointer on hover */
            font-family: var(--font-family-apple); /* Sets the font */
            font-size: 15px; /* Sets the font size */
            font-weight: 500; /* Sets the font weight */
            transition: background-color 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease; /* Smooth transitions */
            flex-shrink: 0; /* Prevents button from shrinking */
            margin-left: 8px; /* Adds space to the left if multiple buttons */
            box-shadow: var(--button-shadow-idle); /* Applies idle state shadow */
            /* text-shadow: var(--button-text-shadow); */ /* Optional: text shadow */
        }
        /* Hover state for header buttons */
        .header-button:hover {
            background-color: var(--hover-accent-color); /* Changes background on hover */
            box-shadow: var(--button-shadow-hover); /* Applies hover shadow */
            transform: translateY(-1px); /* Slight upward lift on hover */
        }
        /* Active (pressed) state for header buttons */
        .header-button:active {
            background-color: var(--selected-accent-color); /* Changes background when active */
            transform: scale(0.97) translateY(0px);  /* Slightly scales down */
            box-shadow: var(--button-shadow-active); /* Applies active shadow */
        }
        /* Disabled state for header buttons */
        .header-button:disabled { 
            background-color: var(--ios-system-gray-3); /* Changes background for disabled state */
            color: var(--ios-system-gray-1); /* Changes text color for disabled state */
            cursor: not-allowed; /* Changes cursor to indicate disabled */
            transform: none; /* Resets any transform */
            box-shadow: none; /* Removes shadow for disabled state */
            /* text-shadow: none; */ /* Removes text shadow */
        }

        /* Container for the Markdown viewer (rendered output or editor) */
        .markdown-viewer {
            padding: 0;  /* No padding by default, handled by children */
            flex-grow: 1; /* Allows it to take available vertical space */
            overflow-y: hidden; /* Hides vertical overflow, children handle their own scroll */
            position: relative;  /* Sets positioning context */
            display: flex;  /* Uses flexbox for layout */
            flex-direction: column;  /* Arranges children vertically */
        }
        
        /* Styling for both the Markdown output display and the WYSIWYG editor container */
        #markdown-output,
        #wysiwyg-editor-container {
            flex-grow: 1; /* Allows each view to take available space */
            overflow-y: auto; /* Each view scrolls independently */
            padding: 20px 24px; /* Adds padding */
            box-sizing: border-box; /* Includes padding in total height/width */
            line-height: 1.6; /* Consistent line height */
        }

        /* Styling for the content within the Toast UI Editor */
        #wysiwyg-editor-container .toastui-editor-contents {
            font-family: var(--font-family-apple); /* Matches app font if possible */
            font-size: 17px; /* Matches paragraph font size for consistency */
        }
        /* Specific padding adjustment for the WYSIWYG editor container if needed */
        #wysiwyg-editor-container {
             padding: 0; /* TUI editor might have its own internal padding, so reset here */
        }

        /* Styling for the placeholder message in the Markdown output area */
        #markdown-output .placeholder {
            color: var(--text-color-placeholder); /* Sets placeholder text color */
            font-style: normal;  /* Normal font style */
            text-align: center; /* Centers the text */
            padding-top: 80px;  /* Adds padding at the top */
            font-size: 17px;  /* Sets font size */
        }

        /* iOS-inspired Markdown styling for rendered HTML */
        #markdown-output h1, 
        #markdown-output h2, 
        #markdown-output h3, 
        #markdown-output h4, 
        #markdown-output h5, 
        #markdown-output h6 {
            font-family: var(--font-family-apple); /* Sets font for headings */
            color: var(--text-color);  /* Sets text color for headings */
            line-height: 1.3; /* Adjusts line height for headings */
            margin-top: 1.5em;  /* Adds top margin */
            margin-bottom: 0.6em;  /* Adds bottom margin */
        }

        /* Specific styling for different heading levels */
        #markdown-output h1 { font-size: 28px; font-weight: 700; border-bottom: 1px solid var(--separator-color); padding-bottom: 0.3em;}
        #markdown-output h2 { font-size: 22px; font-weight: 700; border-bottom: 1px solid var(--separator-color); padding-bottom: 0.3em;}
        #markdown-output h3 { font-size: 20px; font-weight: 600; }
        #markdown-output h4 { font-size: 17px; font-weight: 600; } 
        #markdown-output h5 { font-size: 15px; font-weight: 600; color: var(--text-color-secondary); } 
        #markdown-output h6 { font-size: 13px; font-weight: 500; color: var(--text-color-secondary); text-transform: uppercase; letter-spacing: 0.3px;} 

        /* Styling for paragraphs */
        #markdown-output p { 
            font-size: 17px;  /* Sets font size */
            line-height: 1.5;  /* Adjusts line height */
            margin-bottom: 1em;  /* Adds bottom margin */
            color: var(--text-color); /* Sets text color */
        }
        /* Styling for links */
        #markdown-output a { 
            color: var(--accent-color);  /* Sets link color */
            text-decoration: none;  /* Removes default underline */
            font-weight: inherit;  /* Inherits font weight */
        }
        #markdown-output a:hover { text-decoration: underline; color: var(--hover-accent-color); } /* Adds underline and changes color on hover */
        
        /* Styling for unordered and ordered lists */
        #markdown-output ul, #markdown-output ol { 
            margin-bottom: 1em;  /* Adds bottom margin */
            padding-left: 1.5em;  /* Adds left padding for indentation */
            font-size: 17px; /* Sets font size */
        }
        #markdown-output li { margin-bottom: 0.4em; } /* Adds bottom margin to list items */
        
        /* Styling for blockquotes */
        #markdown-output blockquote {
            border-left: 3px solid var(--ios-system-gray-3);  /* Adds a left border */
            padding: 0.8em 1em; /* Adds padding */
            margin-left: 0; /* No left margin */
            margin-bottom: 1em; /* Adds bottom margin */
            background-color: transparent;  /* Transparent background */
            color: var(--text-color-secondary); /* Sets text color */
            font-size: 17px; /* Sets font size */
        }
        /* Styling for inline code snippets */
        #markdown-output code { 
            background-color: var(--ios-system-gray-5);  /* Sets background color */
            padding: 0.2em 0.4em; /* Adds padding */
            border-radius: calc(var(--border-radius-standard) - 4px); /* Applies rounded corners */
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; /* Sets monospace font stack */
            font-size: 0.9em;  /* Slightly smaller font size */
            color: var(--text-color);  /* Sets text color */
        }
        /* Styling for code blocks (preformatted text) */
        #markdown-output pre { 
            background-color: #23241f;  /* Dark background color for code blocks */
            color: #f8f8f2;  /* Light text color for contrast */
            padding: 1em; /* Adds padding */
            border-radius: var(--border-radius-standard); /* Applies rounded corners */
            overflow-x: auto; /* Adds horizontal scrollbar if content overflows */
            margin-bottom: 1.2em; /* Adds bottom margin */
            border: 1px solid #3a3b35;  /* Adds a border */
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; /* Sets monospace font stack */
            font-size: 14px;  /* Sets font size */
            line-height: 1.45; /* Adjusts line height */
        }
        /* Styling for code elements within preformatted text (to reset some styles) */
        #markdown-output pre code {
            background-color: transparent; /* Transparent background */
            padding: 0; /* No padding */
            color: inherit; /* Inherits text color from parent (pre) */
            font-size: inherit;  /* Inherits font size */
            line-height: inherit; /* Inherits line height */
        }
        /* Styling for tables */
        #markdown-output table {
            border-collapse: collapse;  /* Collapses table borders */
            width: 100%;  /* Table takes full width */
            margin-bottom: 1.2em; /* Adds bottom margin */
            border: 1px solid var(--border-color);  /* Adds a border around the table */
            font-size: 15px;  /* Sets font size */
        }
        /* Styling for table headers (th) and table data cells (td) */
        #markdown-output th, #markdown-output td {
            border: 1px solid var(--border-color);  /* Adds borders to cells */
            padding: 8px 10px;  /* Adds padding within cells */
            text-align: left; /* Aligns text to the left */
        }
        /* Specific styling for table headers */
        #markdown-output th {
            background-color: var(--ios-system-gray-6);  /* Sets background color for headers */
            font-weight: 600;  /* Makes header text bold */
            color: var(--text-color); /* Sets text color */
        }
        
        /* Styling for images */
        #markdown-output img {
            max-width: 100%; /* Ensures images don't overflow their container */
            height: auto; /* Maintains aspect ratio */
            border-radius: var(--border-radius-standard); /* Applies rounded corners */
            margin-bottom: 1em; /* Adds bottom margin */
        }

        /* iOS-like Scrollbar styling for WebKit-based browsers (Chrome, Safari, Edge) */
        ::-webkit-scrollbar {
            width: 7px;  /* Width of the scrollbar */
            height: 7px; /* Height of the scrollbar (for horizontal scrollbars) */
        }
        ::-webkit-scrollbar-track {
            background: transparent;  /* Transparent track */
        }
        ::-webkit-scrollbar-thumb {
            background: var(--ios-system-gray-3);  /* Color of the scrollbar thumb */
            border-radius: 4px; /* Rounded corners for the thumb */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--ios-system-gray-2); /* Darker thumb color on hover */
        }

        /* Responsive Design Adjustments for tablets and larger phones */
        @media (max-width: 1024px) { /* Applies when screen width is 1024px or less */
            :root { /* Overrides root variables for this breakpoint */
                --sidebar-width: 280px;  /* Reduces sidebar width */
                --app-padding: 12px; /* Reduces app padding */
            }
            body {
                padding: var(--app-padding); /* Applies new padding to the body */
            }
            .app-container {
                max-height: calc(100vh - (2 * var(--app-padding))); /* Adjusts max height with new padding */
            }
            /* Adjusts font sizes for Markdown content */
            #markdown-output h1 { font-size: 26px; }
            #markdown-output h2 { font-size: 20px; }
            #markdown-output h3 { font-size: 18px; }
            #markdown-output p, #markdown-output ul, #markdown-output ol { font-size: 16px; }
        }

        /* Responsive Design Adjustments for mobile devices */
        @media (max-width: 768px) { /* Applies when screen width is 768px or less */
            :root { /* Overrides root variables for this breakpoint */
                --sidebar-width: 100%;  /* Sidebar takes full width */
                --header-height: 44px; /* Reduces header height */
                --title-bar-height: 34px; /* Reduces title bar height */
                --app-padding: 0;  /* Removes app padding */
                --border-radius-large: 0px;  /* Removes large border radius (app container becomes square) */
            }

            body {
                padding: 0;  /* Removes body padding */
                align-items: stretch;  /* Stretches items to fill container height */
                /* Ensure body takes full height to push footer down if content is short */
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }

            .app-container {
                width: 100%; /* Full width */
                max-width: 100%; /* Full width */
                /* Let app-container grow but not necessarily fill the whole screen if footer is present */
                flex-grow: 1; 
                /* height: 100vh; */ /* Removed to allow footer to sit below */
                /* max-height: 100vh; */ /* Removed */
                border-radius: 0;  /* No border radius */
                border: none;  /* No border */
                box-shadow: none;  /* No box shadow */
            }

            .window-title-bar {
                border-top-left-radius: 0; /* Removes top-left border radius */
                border-top-right-radius: 0; /* Removes top-right border radius */
                padding: 0 10px;  /* Adjusts padding */
            }
            .mobile-menu-button {
                display: flex;  /* Shows the mobile menu button */
                align-items: center; /* Aligns icon vertically */
            }
            .window-title-text {
                padding: 0 10px 0 0;  /* Adjusts padding */
                margin-left: 10px;  /* Adds left margin */
                text-align: left;  /* Aligns text to the left */
                flex-grow: 1; /* Allows text to take space */
            }
            .traffic-light { /* Smaller traffic lights on mobile */
                width: 10px;
                height: 10px;
                margin-right: 6px;
            }

            .main-content-wrapper {
                flex-direction: column;  /* Stacks sidebar and content vertically */
                position: relative;  /* For positioning the sidebar */
                height: calc(100% - var(--title-bar-height));  /* Adjusts height */
            }

            .sidebar {
                position: absolute; /* Positions sidebar absolutely for overlay effect */
                top: 0;
                left: 0;
                width: 100%;  /* Full width */
                z-index: 1000;  /* Ensures sidebar is on top */
                height: auto;  /* Height adjusts to content */
                max-height: 50vh;  /* Limits max height */
                border-right: none;  /* Removes right border */
                border-bottom: 1px solid var(--border-color);  /* Adds bottom border */
                background-color: var(--sidebar-background);  /* Sets background */
                transform: translateY(-100%); /* Hides sidebar off-screen by default */
                transition: transform 0.3s ease-out; /* Smooth transition for sliding in/out */
                padding: 12px;  /* Adjusts padding */
            }

            .sidebar.mobile-visible { /* Class added by JS to show sidebar */
                transform: translateY(0%); /* Slides sidebar into view */
                box-shadow: 0 4px 12px rgba(0,0,0,0.1), 0 0 0 0.5px rgba(0,0,0,0.06);  /* Adds shadow when visible */
            }
            
            .sidebar-header {  /* Adjusts sidebar header for mobile */
                font-size: 17px; 
                font-weight: 600; 
                margin-bottom: 16px;
                padding-top: 8px; 
                padding-bottom: 12px;
            }

            .folder-selection-area { /* Stacks folder/file buttons vertically on mobile */
                grid-template-columns: 1fr; 
                gap: 10px; 
            }
            .content-header { /* Adjusts content header padding on mobile */
                padding: 0 10px; 
            }
            #contentHeaderText { /* Adjusts content header text for mobile */
                margin-right: 4px; 
                font-size: 16px; 
            }
            .header-button { /* Smaller header buttons on mobile */
                padding: 6px 10px; 
                font-size: 14px;
                margin-left: 4px;
            }
            #markdown-output, 
            #wysiwyg-editor-container { /* Adjusts padding for content areas on mobile */
                padding: 15px;
            }
            #wysiwyg-editor-container .toastui-editor-contents { /* Adjusts TUI editor font size for mobile */
                font-size: 16px; 
            }
        }

        /* Wrapper for the entire application, including app-container and footer */
        /* This helps in positioning the footer correctly, especially with flexbox on body */
        .app-wrapper { 
            display: flex; /* Uses flexbox */
            flex-direction: column; /* Stacks children (app-container, footer) vertically */
            align-items: center; /* Centers children horizontally */
            width: 100%; /* Takes full width */
            padding: var(--app-padding); /* Uses the main app padding variable */
            box-sizing: border-box; /* Includes padding in total width/height */
            flex-grow: 1; /* Allows this wrapper to grow and fill space, pushing footer down */
        }

        /* Footer styling */
        .footer {
            width: 100%; /* Takes full width */
            max-width: var(--app-max-width); /* Aligns with the app-container's max width */
            padding: 15px 0; /* Adds vertical padding */
            text-align: center; /* Centers the text content */
            font-size: 12px; /* Sets a smaller font size for footer text */
            color: var(--ios-label-tertiary); /* Uses a subtle text color */
            font-family: var(--font-family-apple); /* Sets the font */
            margin-top: 20px; /* Adds space above the footer */
            display: flex; /* Uses flexbox for aligning items within the footer */
            justify-content: center; /* Centers items horizontally */
            align-items: center; /* Aligns items vertically */
            gap: 10px; /* Adds space between the text and the GitHub logo */
            flex-shrink: 0; /* ADDED - Prevents footer from shrinking */
        }

        /* Styling for links within the footer */
        .footer a {
            color: var(--ios-label-secondary); /* Slightly more prominent color for the link */
            text-decoration: none; /* Removes default underline */
            display: inline-flex; /* Allows vertical alignment of icon with text if needed */
            align-items: center; /* Vertically aligns icon with text */
        }

        /* Hover state for footer links */
        .footer a:hover {
            color: var(--accent-color); /* Changes color to accent color on hover */
            text-decoration: underline; /* Adds underline on hover */
        }

        /* Styling for the GitHub logo SVG within the footer link */
        .footer .github-logo svg {
            width: 18px; /* Sets the width of the SVG icon */
            height: 18px; /* Sets the height of the SVG icon */
            fill: currentColor; /* Makes the SVG icon inherit its color from the parent 'a' tag */
        }

    </style>
</head>
<body>
    <!-- App Wrapper: Contains the main app window and the footer -->
    <div class="app-wrapper"> 
        <!-- Main Application Container: Simulates a desktop application window -->
        <div class="app-container">
            <!-- Window Title Bar: Mimics a macOS window title bar -->
            <div class="window-title-bar">
                <!-- Traffic Lights: Decorative macOS-style window control buttons -->
                <div class="traffic-lights">
                    <span class="traffic-light red"></span> <!-- Red "close" button -->
                    <span class="traffic-light yellow"></span> <!-- Yellow "minimize" button -->
                    <span class="traffic-light green"></span> <!-- Green "maximize" button -->
                </div>
                <!-- Window Title Text: Displays the application title -->
                <div class="window-title-text">Markdown Viewer</div>
                <!-- Mobile Menu Button: Hamburger icon for toggling sidebar on mobile -->
                <button class="mobile-menu-button" id="mobileMenuButton" aria-label="Toggle Menu" aria-expanded="false">
                    <svg viewBox="0 0 100 80" width="20" height="20"> <!-- SVG for the hamburger icon -->
                        <rect width="100" height="15" rx="8"></rect>
                        <rect y="30" width="100" height="15" rx="8"></rect>
                        <rect y="60" width="100" height="15" rx="8"></rect>
                    </svg>
                </button>
            </div>
            <!-- Main Content Wrapper: Contains the sidebar and the main content area -->
            <div class="main-content-wrapper">
                <!-- Sidebar: For navigation and file selection -->
                <aside class="sidebar" id="sidebar">
                    <!-- Sidebar Header: Title for the sidebar (e.g., "Explorer") -->
                    <div class="sidebar-header">Explorer</div>
                    <!-- Folder Selection Area: Contains buttons for opening folders/files -->
                    <div class="folder-selection-area">
                        <button id="folderInputButton">Ordner auswählen...</button> <!-- Button to select a folder -->
                        <button id="singleFileInputButton">Datei auswählen...</button> <!-- Button to select a single file -->
                        <!-- Displays the name of the selected folder -->
                        <div id="selectedFolderName" style="display: none;"></div> 
                    </div>
                    <!-- File Browser Header: Title for the file list (e.g., "Dateien") -->
                    <div class="file-browser-header" id="fileBrowserHeader" style="display: none;">Dateien</div>
                    <!-- File Browser: Contains the list of files -->
                    <div class="file-browser">
                        <ul id="fileList"></ul> <!-- Unordered list to display file names -->
                    </div>
                </aside>
                <!-- Content Area: Main area for displaying Markdown or editor -->
                <main class="content-area">
                    <!-- Content Header: Displays the current file name and action buttons -->
                    <div class="content-header" id="contentHeaderContainer">
                        <!-- Displays the name of the currently selected file or a placeholder -->
                        <div id="contentHeaderText">Keine Datei ausgewählt</div>
                        <!-- Wrapper for header buttons (e.g., Edit/Save) -->
                        <div> 
                            <button id="editButton" class="header-button" style="display: none;">Bearbeiten</button> <!-- Button to toggle edit/save mode -->
                        </div>
                    </div>
                    <!-- Markdown Viewer: Container for rendered Markdown or WYSIWYG editor -->
                    <div class="markdown-viewer">
                        <!-- Output area for rendered Markdown content or placeholder message -->
                        <div id="markdown-output" class="placeholder">Wählen Sie einen Ordner oder eine Datei aus.</div>
                        <!-- Container for the Toast UI WYSIWYG editor -->
                        <div id="wysiwyg-editor-container" style="display: none;"></div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Footer: Displays attribution and GitHub link -->
        <footer class="footer">
            <span>Prompted by: Marsel Nenaj, Coded by Model Gemini 2.5 Pro</span> <!-- Attribution text -->
            <!-- Link to GitHub repository with a GitHub logo icon -->
            <a href="https://github.com/marselnenaj/modern-markdown-editor-html5" target="_blank" rel="noopener noreferrer" aria-label="GitHub Repository" class="github-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="bi bi-github"> <!-- SVG for GitHub logo -->
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                </svg>
            </a>
        </footer>
    </div>

    <!-- Hidden file input elements for selecting folders and files -->
    <input type="file" id="folderInput" webkitdirectory directory style="display: none;" /> <!-- For selecting directories (folders) -->
    <input type="file" id="singleFileInput" accept=".md, .txt, .markdown" style="display: none;" /> <!-- For selecting single files (Markdown, text) -->

    <script>
        // DOM Element References: Get references to various HTML elements by their IDs
        const folderInput = document.getElementById('folderInput'); // Hidden input for folder selection
        const singleFileInput = document.getElementById('singleFileInput'); // Hidden input for single file selection
        const folderInputButton = document.getElementById('folderInputButton'); // Button to trigger folder selection
        const singleFileInputButton = document.getElementById('singleFileInputButton'); // Button to trigger single file selection
        const fileList = document.getElementById('fileList'); // UL element to display the list of files
        const markdownOutput = document.getElementById('markdown-output'); // Div to display rendered Markdown or placeholder
        const contentHeaderText = document.getElementById('contentHeaderText');  // Div to display the current file name in the header
        const selectedFolderNameDiv = document.getElementById('selectedFolderName'); // Div to display the name of the selected folder
        const fileBrowserHeader = document.getElementById('fileBrowserHeader'); // Header for the file browser section
        const mobileMenuButton = document.getElementById('mobileMenuButton'); // Button to toggle the sidebar on mobile
        const sidebar = document.getElementById('sidebar'); // The sidebar element
        
        const editButton = document.getElementById('editButton'); // Button to toggle between edit and save mode
        const wysiwygEditorContainer = document.getElementById('wysiwyg-editor-container'); // Container for the Toast UI WYSIWYG editor
        let tuiEditor = null; // Variable to hold the Toast UI Editor instance

        // State Variables: Manage the application's current state
        let currentFiles = []; // Array to store currently loaded files (either from a folder or a single file)
        let currentFolderHandle = null; // File System API folder handle (not used in this version but good for future)
        let currentFileHandle = null; // File System API file handle (not used in this version)
        let currentFolderPath = ''; // Path or name of the currently selected folder
        
        let isEditMode = false; // Boolean flag to indicate if the application is in edit mode
        let currentFileRawContent = ''; // Stores the raw text content of the currently displayed file
        
        // Event Listener for Mobile Menu Button: Toggles the visibility of the sidebar on mobile devices
        mobileMenuButton.addEventListener('click', () => {
            const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true' || false; // Check current state
            mobileMenuButton.setAttribute('aria-expanded', !isExpanded); // Toggle ARIA attribute
            sidebar.classList.toggle('mobile-visible'); // Toggle CSS class to show/hide sidebar
        });

        // Event Listeners for File/Folder Selection Buttons: Trigger click on hidden file input elements
        folderInputButton.addEventListener('click', () => folderInput.click()); // Opens folder selection dialog
        singleFileInputButton.addEventListener('click', () => singleFileInput.click()); // Opens file selection dialog

        // Event Listener for Folder Input: Handles folder selection
        folderInput.addEventListener('change', async (event) => {
            const files = event.target.files; // Get the list of files from the selected folder
            if (files.length > 0) {
                // Filter for Markdown and text files
                currentFiles = Array.from(files).filter(file => file.name.endsWith('.md') || file.name.endsWith('.markdown') || file.name.endsWith('.txt'));
                currentFolderHandle = null; // Reset folder handle (not used with <input type="file"> directly for handle)
                currentFileHandle = null; // Reset file handle
                const firstFile = files[0]; // Get the first file to determine the folder path
                // Attempt to get a folder name from webkitRelativePath, otherwise use a generic name
                currentFolderPath = firstFile.webkitRelativePath ? firstFile.webkitRelativePath.split('/')[0] : 'Ausgewählter Ordner';
                
                // Update UI to show selected folder name and file browser
                selectedFolderNameDiv.textContent = currentFolderPath;
                selectedFolderNameDiv.style.display = 'block';
                fileBrowserHeader.style.display = 'block';
                renderFileList(); // Populate the file list in the sidebar

                // Try to display the first Markdown file found, otherwise show a message
                if (currentFiles.length > 0) {
                    const firstMdFile = currentFiles.find(f => f.name.endsWith('.md') || f.name.endsWith('.markdown'));
                    if (firstMdFile) {
                        await displayFileContent(firstMdFile, firstMdFile.name); // Display its content
                    } else {
                        handleNoFileSelected("Keine Markdown-Datei im Ordner gefunden."); // No Markdown files
                    }
                } else {
                    handleNoFileSelected("Keine anzeigbaren Dateien im Ordner gefunden."); // No suitable files at all
                }
            }
        });

        // Event Listener for Single File Input: Handles single file selection
        singleFileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0]; // Get the selected file
            if (file) {
                currentFiles = [file]; // Store the file in the currentFiles array
                currentFolderHandle = null; // Reset folder handle
                currentFileHandle = null;  // Reset file handle
                currentFolderPath = '';  // No folder path for single file
                selectedFolderNameDiv.style.display = 'none'; // Hide folder name display
                fileBrowserHeader.style.display = 'block'; // Show file browser header (for the single file)
                renderFileList(); // Render the single file in the list
                await displayFileContent(file, file.name); // Display its content
            }
        });

        // Function to Render File List: Populates the sidebar with names of loaded files
        function renderFileList() {
            fileList.innerHTML = ''; // Clear any existing file list items
            currentFiles.forEach(file => { // Iterate over the current files
                const li = document.createElement('li'); // Create a new list item element
                li.textContent = file.name; // Set its text to the file name
                // Add event listener to display file content when a file name is clicked
                li.addEventListener('click', async () => { 
                    await displayFileContent(file, file.name); // Display content
                    highlightSelectedFile(file.name); // Highlight the clicked file in the list
                    // If on mobile and sidebar is visible, hide it after selection
                    if (sidebar.classList.contains('mobile-visible')) {
                        sidebar.classList.remove('mobile-visible');
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    }
                });
                fileList.appendChild(li); // Add the list item to the file list
            });
        }

        // Function to Display File Content: Reads and shows the content of a selected file
        async function displayFileContent(fileOrHandle, fileName) {
            try {
                let file;
                // Check if it's a FileSystemFileHandle (not used in current input method but good for future) or a standard File object
                if (fileOrHandle.getFile) {  // This would be for File System Access API handles
                    file = await fileOrHandle.getFile();
                } else { // This is for standard File objects from <input type="file">
                    file = fileOrHandle;
                }
                const reader = new FileReader(); // Create a FileReader to read the file content
                // Define what happens when the file is successfully loaded
                reader.onload = (e) => {
                    currentFileRawContent = e.target.result; // Store the raw file content
                    contentHeaderText.textContent = fileName; // Update the header with the file name
                    editButton.style.display = 'inline-block'; // Show the edit button
                    editButton.disabled = false; // Enable the edit button

                    if (isEditMode) {
                        // If in edit mode, update the TUI editor's content
                        if (tuiEditor) tuiEditor.setMarkdown(currentFileRawContent);
                        // Fallback: if TUI editor isn't initialized (should not happen if logic is correct)
                        else initializeTuiEditor(currentFileRawContent); 
                    } else {
                        // If in view mode, render Markdown and destroy TUI editor if it exists
                        markdownOutput.innerHTML = marked.parse(currentFileRawContent); // Parse Markdown to HTML
                        markdownOutput.style.display = 'block'; // Show Markdown output area
                        wysiwygEditorContainer.style.display = 'none'; // Hide WYSIWYG editor
                        if (tuiEditor) { tuiEditor.destroy(); tuiEditor = null; } // Clean up TUI editor instance
                    }
                    markdownOutput.classList.remove('placeholder'); // Remove placeholder class if content is loaded
                };
                // Define what happens if there's an error reading the file
                reader.onerror = () => displayErrorLoadingFile(fileName);
                reader.readAsText(file); // Start reading the file as text
            } catch (error) {
                console.error('Error accessing file:', error); // Log error to console
                displayErrorLoadingFile(fileName); // Show error message in UI
            }
        }

        // Function to Initialize Toast UI Editor: Creates or recreates the WYSIWYG editor
        function initializeTuiEditor(content) {
            if (tuiEditor) { tuiEditor.destroy(); tuiEditor = null; } // Destroy existing instance if any
            // Create a new Toast UI Editor instance
            tuiEditor = new toastui.Editor({
                el: wysiwygEditorContainer, // The HTML element to host the editor
                initialValue: content, // The initial content for the editor
                previewStyle: 'tab', // Use TUI's own preview/mode switch (though we manage modes externally)
                height: '100%', // Make the editor take full height of its container
                initialEditType: 'wysiwyg', // Start in WYSIWYG mode by default
                usageStatistics: false // Disable Toast UI's usage statistics tracking
            });
        }
        
        // Function to Handle No File Selected: Updates UI when no file is active
        function handleNoFileSelected(message) {
            displayPlaceholder(message); // Show the provided message as a placeholder
            contentHeaderText.textContent = "Keine Datei ausgewählt"; // Reset header text
            editButton.style.display = 'none'; // Hide edit button
            if (isEditMode) saveAndSwitchToViewMode(); // If in edit mode, save and switch back to view mode
        }

        // Function to Display Error Loading File: Shows an error message in the UI
        function displayErrorLoadingFile(fileName) {
            markdownOutput.innerHTML = `<div class="placeholder">Fehler beim Laden der Datei: ${fileName}.</div>`; // Show error
            markdownOutput.classList.add('placeholder'); // Add placeholder class for styling
            contentHeaderText.textContent = "Fehler"; // Update header text
            currentFileRawContent = ''; // Clear raw content
            editButton.style.display = 'none'; // Hide edit button
            if (isEditMode) saveAndSwitchToViewMode(); // If in edit mode, save and switch back
        }

        // Function to Display Placeholder: Shows a message in the main content area
        function displayPlaceholder(message) {
            markdownOutput.innerHTML = message; // Set the message
            markdownOutput.classList.add('placeholder'); // Add placeholder class
            currentFileRawContent = ''; // Clear raw content
            editButton.style.display = 'none'; // Hide edit button
            if (isEditMode) saveAndSwitchToViewMode(); // If in edit mode, save and switch back
        }

        // Function to Highlight Selected File: Visually marks the active file in the sidebar list
        function highlightSelectedFile(fileName) {
            const items = fileList.querySelectorAll('li'); // Get all file list items
            items.forEach(item => {
                // Add 'selected' class if item's text matches fileName, remove otherwise
                item.classList.toggle('selected', item.textContent === fileName);
            });
        }

        // Event Listener for Edit/Save Button: Toggles between viewing and editing modes
        editButton.addEventListener('click', () => {
            if (isEditMode) { // If currently in edit mode (button shows "Speichern")
                saveAndSwitchToViewMode(); // Save content and switch to view mode
            } else { // If currently in view mode (button shows "Bearbeiten")
                // Check if there's content to edit
                if (!currentFileRawContent && currentFiles.length === 0 && !currentFileHandle) { 
                     alert("Bitte laden Sie zuerst eine Datei, um sie zu bearbeiten."); // Show alert if no file loaded
                     return;
                }
                switchToEditMode(); // Switch to edit mode
            }
        });

        // Function to Switch to Edit Mode: Configures UI for editing
        function switchToEditMode() {
            isEditMode = true; // Set edit mode flag
            editButton.textContent = 'Speichern'; // Change button text to "Speichern" (Save)
            markdownOutput.style.display = 'none'; // Hide the rendered Markdown output

            // Initialize or update the Toast UI editor with the current file content
            initializeTuiEditor(currentFileRawContent);
            wysiwygEditorContainer.style.display = 'block'; // Show the WYSIWYG editor container
        }

        // Function to Save Content and Switch to View Mode: Saves changes and returns to viewing
        function saveAndSwitchToViewMode() {
            if (tuiEditor) { // If the TUI editor instance exists
                currentFileRawContent = tuiEditor.getMarkdown(); // Get the Markdown content from the editor
                tuiEditor.destroy(); // Destroy the editor instance to free up resources
                tuiEditor = null; // Reset the editor variable
            }
            
            // Display the (potentially updated) content as rendered Markdown
            markdownOutput.innerHTML = marked.parse(currentFileRawContent);
            markdownOutput.style.display = 'block'; // Show Markdown output
            wysiwygEditorContainer.style.display = 'none'; // Hide WYSIWYG editor

            editButton.textContent = 'Bearbeiten'; // Change button text back to "Bearbeiten" (Edit)
            isEditMode = false; // Reset edit mode flag

            // Determine if the edit button should still be visible and enabled
            if (currentFileRawContent || currentFiles.length > 0 || currentFileHandle) { 
                 editButton.style.display = 'inline-block';
                 editButton.disabled = false;
            } else {
                 editButton.style.display = 'none';
            }
        }
        
        // Initial Application State Setup
        displayPlaceholder("Wählen Sie einen Ordner oder eine Datei aus."); // Show initial placeholder message
        editButton.style.display = 'none'; // Hide the edit button initially

    </script>
</body>
</html>
